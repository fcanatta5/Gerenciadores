#!/usr/bin/env bash
# extra/gettext 0.26 - build script para adm

NAME="gettext"
CATEGORY="extra"
VERSION="0.26"

URL="https://ftp.gnu.org/gnu/gettext/gettext-0.26.tar.xz"
SHA256="d1fb86e260cfe7da6031f94d2e44c0da55903dbae0a2fa0fae78c91ae1b56f00"

DEPENDS=""
BUILD_DEPENDS="perl"

PREFIX="/usr"
BUILD_SYSTEM="autotools"

CONFIGURE_OPTS="
  --prefix=$PREFIX
  --disable-static
  --docdir=$PREFIX/share/doc/gettext-$VERSION
"

pkg_prepare() {
  make distclean >/dev/null 2>&1 || true
}

pkg_configure() {
  rm -rf build
  mkdir -p build
  cd build
  ../configure $CONFIGURE_OPTS
}

pkg_build() {
  cd build
  make -j"${JOBS:-1}"
}

pkg_install() {
  cd build
  make DESTDIR="$DESTDIR" install

  # LFS ajusta permissão pós-install; faça isso no staging (DESTDIR)
  if [[ -e "$DESTDIR$PREFIX/lib/preloadable_libintl.so" ]]; then
    chmod 0755 "$DESTDIR$PREFIX/lib/preloadable_libintl.so"
  fi

  find "$DESTDIR" -name '*.la' -delete 2>/dev/null || true
}

pkg_post() { :; }
