#!/usr/bin/env bash
NAME="ca-certificates"
CATEGORY="extra"
VERSION="1.5.6"

# Fonte: tarball que contém res/cacert.pem (bundle Mozilla)
# URL obtida do próprio Launchpad (source package)
URL="https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/php-composer-ca-bundle/1.5.6-1/php-composer-ca-bundle_1.5.6.orig.tar.xz"
SHA256="539fe02fb63a883eb1a45a75b7104c308783ed67007c78a7093a0b4f5bcf2aad"

# Não há build: só instalamos o bundle PEM no local “padrão” do sistema.
BUILD_SYSTEM="make"

pkg_install() {
  set -e

  # O tarball contém o bundle em: res/cacert.pem
  if [[ ! -f "res/cacert.pem" ]]; then
    echo "ca-certificates: arquivo res/cacert.pem não encontrado no source."
    exit 1
  fi

  install -d -m 0755 "$DESTDIR/etc/ssl/certs" "$DESTDIR/etc/ssl"

  # Convenções comuns:
  # - /etc/ssl/certs/ca-certificates.crt (Debian/Ubuntu)
  # - /etc/ssl/cert.pem (Alpine/musl costuma apontar pra esse)
  install -m 0644 "res/cacert.pem" \
    "$DESTDIR/etc/ssl/certs/ca-certificates.crt"

  ln -sf "certs/ca-certificates.crt" "$DESTDIR/etc/ssl/cert.pem"
  ln -sf "ca-certificates.crt" "$DESTDIR/etc/ssl/certs/ca-bundle.crt"
}
