#!/usr/bin/env bash
# extra/libtool 2.5.4 - build script para adm
# Compatível com musl, bootstrap e sistema final

NAME="libtool"
CATEGORY="extra"
VERSION="2.5.4"

URL="https://ftpmirror.gnu.org/libtool/libtool-2.5.4.tar.xz"
SHA256="f81f5860666b0bc7d84baddefa60d1cb9fa6fceb2398cc3baca6afaa60266675"

# libtool usa m4 em runtime; perl é usado por scripts durante build/instalação
DEPENDS="m4"
BUILD_DEPENDS="perl"

PREFIX="/usr"
BUILD_SYSTEM="autotools"

CONFIGURE_OPTS="
  --prefix=$PREFIX
  --disable-nls
  --disable-static
"

pkg_prepare() {
  make distclean >/dev/null 2>&1 || true
}

pkg_configure() {
  rm -rf build
  mkdir -p build
  cd build
  ../configure $CONFIGURE_OPTS
}

pkg_build() {
  cd build
  make -j"${JOBS:-1}"
}

pkg_install() {
  cd build
  make DESTDIR="$DESTDIR" install

  # Remove .la (boa prática)
  find "$DESTDIR" -name '*.la' -delete 2>/dev/null || true
}

pkg_post() {
  :
}
