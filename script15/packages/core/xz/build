#!/usr/bin/env bash
# core/xz 5.8.1 - build script para adm
# Compatível com musl, bootstrap e sistema final

NAME="xz"
CATEGORY="core"
VERSION="5.8.1"

# Tarball de release (estável)
URL="https://github.com/tukaani-project/xz/releases/download/v5.8.1/xz-5.8.1.tar.gz"
SHA256="507825b599356c10dca1cd720c9d0d0c9d5400b9de300af00e4d1ea150795543"

DEPENDS=""
BUILD_DEPENDS=""

PREFIX="/usr"
BUILD_SYSTEM="autotools"

CONFIGURE_OPTS="
  --prefix=$PREFIX
  --disable-nls
  --disable-static
"

pkg_prepare() {
  # Limpeza defensiva (rebuild / resume)
  make distclean >/dev/null 2>&1 || true
}

pkg_configure() {
  rm -rf build
  mkdir -p build
  cd build

  ../configure $CONFIGURE_OPTS
}

pkg_build() {
  cd build
  make -j"${JOBS:-1}"
}

pkg_install() {
  cd build
  make DESTDIR="$DESTDIR" install

  # Remove .la (boa prática)
  find "$DESTDIR" -name '*.la' -delete 2>/dev/null || true
}

pkg_post() {
  :
}
