pkgname="linux-headers"
pkgver="6.12.6"
pkgrel=1

# linux-headers vai para o sysroot (ROOTFS)
INSTALL_ROOT="sysroot"

sources=(
  "https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-${pkgver}.tar.xz::linux-${pkgver}.tar.xz"
)

sha256sums=(
  # sha256sums.asc (kernel.org) contém o hash para linux-6.12.6.tar.xz
  "3f6690efe8dc49751e33fbcc45d35fa9048f75e03bfeaaa2a28e1037ca8d85cf linux-6.12.6.tar.xz"
)

pre_build() {
  : "${JOBS:=4}"
  : "${ARCH:=x86_64}"
}

build() {
  # Headers não precisam de build completo do kernel.
  # Garantir tree limpa o suficiente.
  make mrproper >/dev/null 2>&1 || true
}

install() {
  # INSTALA HEADERS em DESTDIR com layout /usr/include
  # Isso é exatamente o que o cross-toolchain.sh precisa para rsync -> ROOTFS.
  make -j"$JOBS" \
    ARCH="$ARCH" \
    INSTALL_HDR_PATH="$DESTDIR/usr" \
    headers_install

  # Limpeza padrão: remove arquivos .install criados pelo processo
  find "$DESTDIR/usr/include" -name '.install' -o -name '..install.cmd' -delete 2>/dev/null || true
}
