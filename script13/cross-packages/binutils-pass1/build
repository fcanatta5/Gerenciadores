pkgname="binutils-pass1"
pkgver="2.45.1"
pkgrel=1

INSTALL_ROOT="tools"

sources=(
  "https://ftp.gnu.org/gnu/binutils/binutils-${pkgver}.tar.xz::binutils-${pkgver}.tar.xz"
)

sha256sums=(
  "5fe101e6fe9d18fdec95962d81ed670fdee5f37e3f48f0bef87bddf862513aa5 binutils-2.45.1.tar.xz"
)

pre_build() {
  : "${TARGET:=x86_64-linux-musl}"
  : "${SYSROOT:=/mnt/adm/rootfs}"
  : "${JOBS:=4}"
}

build() {
  rm -rf _build
  mkdir -p _build
  cd _build

  # IMPORTANTE:
  # prefix=/ para que DESTDIR contenha bin/, lib/ etc na raiz,
  # e o cross-toolchain.sh consiga rsync -> $TOOLS corretamente.
  ../configure \
    --prefix=/ \
    --target="$TARGET" \
    --with-sysroot="$SYSROOT" \
    --disable-nls \
    --disable-werror

  make -j"$JOBS"
}

install() {
  cd _build
  make DESTDIR="$DESTDIR" install

  # enxuto para pass1
  rm -rf "$DESTDIR/share" 2>/dev/null || true
}
