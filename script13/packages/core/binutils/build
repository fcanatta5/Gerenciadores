pkgname="binutils"
pkgver="2.45.1"
pkgrel=1

# Recomendado: binutils usa zlib para seções de debug comprimidas e outros recursos.
# Se você ainda não tiver zlib no sistema, remova esta dependência e troque
# --with-system-zlib por --without-zlib no configure.
depends=(zlib)

sources=(
  "https://ftp.gnu.org/gnu/binutils/binutils-${pkgver}.tar.xz::binutils-${pkgver}.tar.xz"
)

sha256sums=(
  "5fe101e6fe9d18fdec95962d81ed670fdee5f37e3f48f0bef87bddf862513aa5 binutils-2.45.1.tar.xz"
)

pre_build() {
  : "${JOBS:=$(nproc 2>/dev/null || echo 4)}"
}

build() {
  rm -rf _build
  mkdir -p _build
  cd _build

  ../configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --localstatedir=/var \
    --libdir=/usr/lib \
    --enable-64-bit-bfd \
    --enable-plugins \
    --disable-multilib \
    --disable-nls \
    --disable-werror \
    --with-system-zlib

  make -j"$JOBS"
}

install() {
  cd _build
  make DESTDIR="$DESTDIR" install

  # opcional: enxugar docs (mantém o sistema mais limpo)
  rm -rf "$DESTDIR/usr/share/info" "$DESTDIR/usr/share/man" 2>/dev/null || true
}
