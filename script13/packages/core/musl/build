pkgname="musl"
pkgver="1.2.5"
pkgrel=1
category="core"
pkgdesc="musl libc - lightweight C standard library implementation"
url="https://musl.libc.org/"
license="MIT"
arch="x86_64"

depends=()

sources=(
  "https://musl.libc.org/releases/musl-${pkgver}.tar.gz::musl-${pkgver}.tar.gz"
)

sha256sums=(
  # musl-1.2.5.tar.gz
  "a9a118bbe84d8764da0ea0d28b3ab3fae8477fc7e4085d90102b8596fc7c75e4 musl-1.2.5.tar.gz"
)

pre_build() {
  : "${CC:=cc}"
  : "${CFLAGS:=-O2 -pipe}"
  : "${LDFLAGS:=}"
}

build() {
  # O adm entra em SRC_DIR e chama build()
  # Garantir ambiente limpo
  make distclean >/dev/null 2>&1 || true

  # Layout recomendado: loader/libc em /lib, headers em /usr/include
  ./configure \
    --prefix=/usr \
    --syslibdir=/lib

  make -j"$(getconf _NPROCESSORS_ONLN 2>/dev/null || echo 4)"
}

install() {
  # musl respeita DESTDIR
  make DESTDIR="$DESTDIR" install
}
