pkgname="linux-headers"
pkgver="6.12.6"
pkgrel=1

# headers do kernel não dependem de libs externas, só de make + toolchain host
depends=()

sources=(
  "https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-${pkgver}.tar.xz::linux-${pkgver}.tar.xz"
)

sha256sums=(
  "3f6690efe8dc49751e33fbcc45d35fa9048f75e03bfeaaa2a28e1037ca8d85cf linux-6.12.6.tar.xz"
)

pre_build() {
  : "${JOBS:=$(nproc 2>/dev/null || echo 4)}"
  : "${ARCH:=x86_64}"
}

build() {
  # Para instalar headers, não precisa compilar kernel; mas manter árvore limpa ajuda
  make mrproper >/dev/null 2>&1 || true
}

install() {
  # headers_install cria automaticamente o diretório include/ dentro de INSTALL_HDR_PATH
  # Então INSTALL_HDR_PATH="$DESTDIR/usr" resulta em "$DESTDIR/usr/include/..."
  make -j"$JOBS" \
    ARCH="$ARCH" \
    INSTALL_HDR_PATH="$DESTDIR/usr" \
    headers_install

  # Limpeza de arquivos auxiliares (inofensivo se não existir)
  find "$DESTDIR/usr/include" -name '.install' -o -name '..install.cmd' -delete 2>/dev/null || true
}
